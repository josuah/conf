#!/bin/sh -eu

. adm-lib

case $command in
(enable)
	case $(adm-get-os) in
	(OpenBSD)
		rcctl enable "${var_OpenBSD:-name}"
		;;
	(*BSD)
		echo "$name=YES" >/etc/rc.conf.d/$name
		;;
	(AlpineLinux | GentooLinux | DevuanLinux)
		rc-update add "$name" default
		;;
	(VoidLinux)
		ln -sf "/etc/runit/sv/$name" "/run/runit/service"
		;;
	(DebianLinux | RedHatLinux | ArchLinux | SuseLinux)
		systemctl enable "$name"
		;;
	(*)
		die "Unknown OS"
		;;
	esac
	;;
(disable)
	case $(adm-get-os) in
	(OpenBSD)
		rcctl disable "$name"
		;;
	(*BSD)
		rm -f "/etc/rc.conf.d/$name"
		;;
	(AlpineLinux | GentooLinux | DevuanLinux)
		rc-update del "$name" default
		;;
	(VoidLinux)
		rm -f "/run/runit/service/$name"
		;;
	(DebianLinux | RedHatLinux | ArchLinux | SuseLinux)
		systemctl disable "$name"
		;;
	(*)
		die "Unknown OS"
		;;
	esac
	;;
(start)
	case $(adm-get-os) in
	(*BSD)
		"/etc/rc.d/$name" start
		;;
	(AlpineLinux | GentooLinux | DevuanLinux)
		rc-service start "$command"
		;;
	(VoidLinux)
		sv up "$name"
		;;
	(DebianLinux | RedHatLinux | ArchLinux | SuseLinux)
		systemctl start "$name"
		;;
	(*)
		die "Unknown OS"
		;;
	esac
	;;
(stop)
	case (adm-get-os) in
	(*BSD)
		"/etc/rc.d/$name" stop
		;;
	(AlpineLinux | GentooLinux | DevuanLinux)
		rc-service stop "$command"
		;;
	(VoidLinux)
		sv down "$name"
		;;
	(DebianLinux | RedHatLinux | ArchLinux | SuseLinux)
		systemctl stop "$name"
		;;
	(*)
		die "Unknown OS"
		;;
	esac
	;;
(status)
	case $(adm-get-os) in
	(OpenBSD)
		"/etc/rc.d/$name" check
		;;
	(*BSD)
		"/etc/rc.d/$name" status
		;;
	(AlpineLinux | GentooLinux | DevuanLinux)
		rc-service status "$command"
		;;
	(VoidLinux)
		sv status "$name"
		;;
	(DebianLinux | RedHatLinux | ArchLinux | SuseLinux)
		systemctl status "$name"
		;;
	(*)
		die "Unknown OS"
		;;
	esac
	;;
esac
