#!/bin/sh -eu
host=host/$(hostname -s)
base=$(cd $(dirname "$0")/..; pwd)
bin=$base/bin

[ -f "$host" ] || { echo>&2 "$host does not exist"; exit 1; }

while read item; do
	case $item in
	(module/*)
		"$bin/module" "$item"
		;;
	(role/*)
		while read role; do
			"$bin/module" "$role"
		done <$item
		;;
	esac
done <$host
