#!/bin/sh -e

command=${1:?}
root=${2:-host/$(hostname -s)}
base=$(cd "${0%/*}/.."; pwd)

while read node args; do
	if [ -f "$base/bin/do-${node%/*}" ]; then
		"$base/bin/do-${node%/*}" "$command" "$node" $args || exit=1
	fi
done <<%
$(bin/list "$root" )
%

exit "${exit:-0}"
