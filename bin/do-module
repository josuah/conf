#!/bin/sh -eu

. "${0%/*}/lib"

case $command in
( install | enable )
	for file in "$base/module/$name/etc/"*; do
		case $file in ( *"/*" | */template.* ) continue ;; esac

		mkdir -p "/etc/$name"
		cp -rf "$file" "/etc/$name"
	done

	for template in "$base/module/$name/etc/template."*; do
		case $template in ( *"/template.*" ) continue ;; esac

		(cd "$base/db"; "$base/bin/template" >$tmp/module) <$template
		mkdir -p "$(dirname "/etc/$name/$conf")"
		mv "$tmp/module" "/etc/$name/$conf"
	done

	if [ -f "$base/module/$name/deploy.sh" ]; then
		(cd "$base/module/$name"; set -x; . ./deploy.sh)
	fi
	;;
esac
