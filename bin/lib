#!/bin/cat source this file

die() {
	echo >&2 "error: $*"
	exit 1
}

trap_add() {
	trap="$trap; $1"
	trap "$trap" INT TERM EXIT HUP
}

trap_pop() {
	trap="${trap%; *}"
	trap "$trap" INT TERM EXIT HUP
}

command=${1:?}
name=${2:?}
name=${name#*/}
name=${name%/}
shift 2

trap=:

tmp=$(mktemp -d)
trap_add 'rm -rf "$tmp"'

host=${host:-$(hostname -s)}
base=$(cd "${0%/*}/.."; pwd)

for var in "$base/var/sys/host/$host/"*; do
	case $var in ( *"/*" ) continue ;; esac
	read "var_${var##*/}" <$var
done

for var in "$@"; do
	export "var_$var"
done
