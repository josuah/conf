#!/bin/sh -eu

cmd=${1:?}
service=${2:?}
shift 2

die() {
	echo >&2 "error: $*"
	exit 1
}

case $cmd in
(enable)
	case $(uname) in
	(OpenBSD)
		rcctl enable "$service"
		[ $# -gt 0 ] && rcctl set "$service" flags "$*"
		;;
	(NetBSD|FreeBSD)
		path=/etc/rc.conf.d/$service
		echo "$service=YES" >$path
		[ $# -gt 0 ] && echo "$service_flags='$*'" >>$path
		;;
	(*) die "no service backend for $cmd" ;;
	esac
	;;
(disable)
	case $(uname) in
	(OpenBSD)
		rcctl disable "$service"
		;;
	(NetBSD|FreeBSD)
		rm -f "/etc/rc.conf.d/$service"
		;;
	(*) die "no service backend for $cmd" ;;
	esac
	;;
(start|stop)
	case $(uname) in
	(*BSD)
		"/etc/rc.d/$service" start
		;;
	(*) die "no service backend for $cmd" ;;
	esac
	;;
(status)
	case $(uname) in
	(OpenBSD)
		"/etc/rc.d/$service" check
		;;
	(*BSD)
		"/etc/rc.d/$service" status
		;;
	(*) die "no service backend for $cmd" ;;
	esac
	;;
esac
