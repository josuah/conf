#!/bin/sh -eu

cmd=${1:?}
service=${2:?}
shift 2

case $("$base/bin/os") in
(openbsd)
	case $cmd in
	(status)
		rcctl check "$service"
		;;
	(*)
		rcctl "$cmd" "$service"
		;;
	esac
	;;
(*bsd)
	case $cmd in
	(enable)
		path=/etc/rc.conf.d/$service
		echo "$service=YES" >$path
		;;
	(disable)
		rm -f "/etc/rc.conf.d/$service"
		;;
	(*)
		"/etc/rc.d/$service" "$cmd"
		;;
	esac
	;;
(alpine|gentoo)
	case $cmd in
	(enable)
		rc-update add "$service" default
		;;
	(disable)
		rc-update del "$service" default
		;;
	(*)
		rc-service "$service" "$cmd"
		;;
	esac
	;;
(void)
	case $cmd in
	(enable)
		ln -sf "/etc/runit/sv/$service" "/run/runit/service"
		;;
	(disable)
		rm -f "/run/runit/service/$service"
		;;
	(start)
		sv up "$service"
		;;
	(*)
		sv "$cmd" "$service"
		;;
	esac
	;;
(debian|redhat|arch|suse)
	case "$cmd" in
	(*)
		systemctl "$cmd" "$service"
		;;
	esac
	;;
(*)
	echo >&2 "error: no service backend for $cmd"
	exit 1
	;;
esac
