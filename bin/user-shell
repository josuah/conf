#!/bin/sh -e
# mostly portably edit an user to set its shell

user=${1:?}
shell=${2:?}

if command -v pw >/dev/null; then
	exec pw usermod "$user" -s "$shell"
elif command -v user >/dev/null; then
	exec user mod -s "$shell" "$user"
elif command -v usermod >/dev/null; then
	exec usermod -s "$shell" "$user"
elif command -v adduser >/dev/null; then 
	tmp=$(mktemp)
	trap 'rm -f "$tmp"' INT TERM EXIT HUP
	awk -F ':' -v u="$user" -v s="$shell" '
		BEGIN { FS = OFS = ":" }
		$1 == u { print $1, $2, $3, $4, $5, s; next } 1
	' /etc/passwd >$tmp
	mv -f "$tmp" "/etc/passwd.tmp"
	exit 0
fi

exit 1
